<!DOCTYPE html><html><head>
      <title>article01</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<div style="width: 100%; background: black; padding: 10px; padding-left: 15px; top: 0; position: relative;"><a href="../blog.html" style="color: white;">&lt; Back</a></div>
<h1 id="industry-standard-toolslibrariesways-to-add-authorization-and-authentication-to-modern-application">Industry Standard Tools/Libraries/Ways to Add Authorization and Authentication To Modern Application </h1>
<div class="article-header">
<img src="../media/heroImage.png" alt="" width="40" style="margin-right: 10px; border-radius: 25px;"> <b>Author:</b> Emmanuel</div>  
<p><strong>Date:</strong>  2024-12-05<br>
<br></p>
<p>At the bottom of this article, you will find recommendations and implementation basics, what is the authorization and authentication approach to choose in each scenario, and why. We will also look at the pros and cons of various authorization and authentication types and how to make decisions that's best for your application.</p>
<br>
<h2 id="h2-styletext-decoration-underline-table-of-contents"></h2><h2 style="text-decoration: underline"> Table of Contents: </h2>

<ul>
<li>Adding Authentication</li>
<li>Authorization</li>
<li>Industry-Standard Tools and Libraries</li>
<li>Full-Service Authentication and Authorization Providers</li>
<li>Middleware for Protection</li>
<li>Best Practices</li>
<li>Example Workflow</li>
<li>Comparison of session-based authentication and stateless authentication (e.g., JWT), along with recommendations for security-conscious use cases.</li>
</ul>
<p>The issue of security in the web/cyber security is an enormous and broad topic, I will be going straight to the points I consider useful at all levels.</p>
<p>Adding authentication and authorization for example, to a REST API with user and product inventory routes is crucial for security. The choice of tools and libraries depends on your stack and requirements. But here are industry-standard ways to implement these features:</p>
<h4 id="authentication">Authentication: </h4>
<p>What is authentication: </p><p style="background: green; color: yellow; padding: 15px">Authentication refers to a process or situation where a server needs to know or verify who is accessing its content. Authentication would usually go both ways the client also wants to be sure the server provider is really who they say they are, so while the server is trying to verify that the client is who they say they are so does a legitimate client the server. In a single sentence, Authentication verifies the identity of a user.</p><p></p>
<p><strong>Industry-Standard Tools and Libraries</strong></p>
<p>1.<strong>JWT (JSON Web Tokens):</strong></p>
<ul>
<li>
<p><span style="font-size: 14px; font-weight: bold">Library:</span></p>
<ul>
<li><a href="https://jwt.io/introduction">jsonwebtoken</a> (Node.js)</li>
</ul>
</li>
<li>
<p><span style="font-size: 14px; font-weight: bold">Use Case:</span> Stateless authentication, where the server does not store session data.</p>
</li>
<li>
<p style="font-size: 14px; font-weight: bold">How It Works:</p>
<ul>
<li>On login, a <code>token</code> is generated and signed with a <code>secret or private key</code>.</li>
<li>The <code>token</code> is sent to the <code>client</code> and included in every request (usually in the Authorization header as Bearer <code>token</code> ).</li>
<li>The server <code>verifies the token to authenticate the user</code>.<br>
<br></li>
</ul>
</li>
</ul>
 <p style="font-size: 14px; font-weight: bold">Basic Example</p>
<pre data-role="codeBlock" data-info="ts" class="language-ts ts"><code><span class="token operator">*</span> TypeScript<span class="token operator">:</span>

<span class="token keyword keyword-import">import</span> jwt <span class="token keyword keyword-from">from</span> <span class="token string">'jsonwebtoken'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">generateToken</span> <span class="token operator">=</span> <span class="token punctuation">(</span>userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> userId <span class="token punctuation">}</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">JWT_SECRET</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> expiresIn<span class="token operator">:</span> <span class="token string">'1h'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">verifyToken</span> <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token operator">?.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Unauthorized'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> decoded <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">JWT_SECRET</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span>user <span class="token operator">=</span> decoded<span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Forbidden'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>2.<strong>OAuth2:</strong></p>
<ul>
<li>
<p><span style="font-size: 14px; font-weight: bold">Libraries:</span></p>
<ul>
<li><a href="https://www.passportjs.org/">Passport.js</a> (general-purpose, supports multiple strategies).</li>
<li><a href="https://github.com/jaredhanson/oauth2orize">OAuth2orize</a> (for building an OAuth2 provider).</li>
</ul>
</li>
<li>
<p><span style="font-size: 14px; font-weight: bold">Use Case:</span>  When integrating with third-party identity providers (e.g., Google, Facebook, GitHub).</p>
</li>
<li>
<p style="font-size: 14px; font-weight: bold">How It Works:</p> Users log in using third-party accounts, and your API validates the access tokens issued by these providers.
</li>
</ul>
<p>3.<strong>Session-Based Authentication:</strong></p>
<ul>
<li>
<p><span style="font-size: 14px; font-weight: bold">Library:</span></p>
<ul>
<li><a href="https://github.com/expressjs/session">express-session</a></li>
</ul>
</li>
<li>
<p><span style="font-size: 14px; font-weight: bold">Use Case:</span>  When you need server-side session storage for user authentication.</p>
</li>
<li>
<p style="font-size: 14px; font-weight: bold">How It Works:</p>
<ul>
<li>On login, the server creates a session and stores it in a database.</li>
<li>A session cookie is sent to the client for subsequent requests.</li>
</ul>
<br>
</li>
</ul>
<h4 id="authorization">Authorization </h4>
<p style="background: green; color: yellow; padding: 15px">On the other hand, authorization simply means controlling access to resources based on user roles and permissions.</p>
<p><strong>Industry-Standard Tools and Libraries</strong></p>
<p>1.<span style="font-size: 14px; font-weight: bold">Role-Based Access Control (RBAC):</span></p>
<ul>
<li>
<p><span style="font-size: 14px; font-weight: bold">Libraries:</span></p>
<ul>
<li><a href="https://casl.js.org/v6/en/">casl</a> (highly flexible for defining abilities and roles).</li>
<li><a href="https://github.com/onury/accesscontrol#readme">accesscontrol</a> (simple RBAC library).</li>
</ul>
</li>
<li>
<p style="font-size: 14px; font-weight: bold">How It Works:</p>
<ul>
<li>Define roles (e.g., <code>admin</code>, <code>user</code>, <code>manager</code>).</li>
<li>Associate permissions with routes (e.g., <code>admin</code> can manage products, <code>user</code> can view inventory).</li>
<li>Middleware checks user roles/permissions before allowing access.<br>
<br></li>
</ul>
</li>
</ul>
 <p style="font-size: 14px; font-weight: bold">Example with CASL:</p>
<pre data-role="codeBlock" data-info="ts" class="language-ts ts"><code><span class="token operator">*</span> TypeScript<span class="token operator">:</span>

<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> AbilityBuilder<span class="token punctuation">,</span> Ability <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'@casl/ability'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">defineAbilitiesFor</span> <span class="token operator">=</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> can<span class="token punctuation">,</span> cannot<span class="token punctuation">,</span> build <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">AbilityBuilder</span><span class="token punctuation">(</span>Ability<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>role <span class="token operator">===</span> <span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">can</span><span class="token punctuation">(</span><span class="token string">'manage'</span><span class="token punctuation">,</span> <span class="token string">'all'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Admins can do everything</span>
  <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
    <span class="token function">can</span><span class="token punctuation">(</span><span class="token string">'read'</span><span class="token punctuation">,</span> <span class="token string">'Product'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Regular users can only read products</span>
    <span class="token function">cannot</span><span class="token punctuation">(</span><span class="token string">'delete'</span><span class="token punctuation">,</span> <span class="token string">'Product'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Regular users cannot delete products</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-return">return</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">checkPermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span>action<span class="token punctuation">,</span> resource<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> ability <span class="token operator">=</span> <span class="token function">defineAbilitiesFor</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>ability<span class="token punctuation">.</span><span class="token function">can</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Forbidden'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Use in routes</span>
app<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/products/:id'</span><span class="token punctuation">,</span> <span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token string">'delete'</span><span class="token punctuation">,</span> <span class="token string">'Product'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Product deletion logic</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>2.<strong>Attribute-Based Access Control (ABAC):</strong></p>
<ul>
<li>
<p><span style="font-size: 14px; font-weight: bold">Libraries:</span></p>
<ul>
<li><a href="https://casbin.org/">casbin</a> (ABAC with flexible policy configurations).</li>
</ul>
</li>
<li>
<p><span style="font-size: 14px; font-weight: bold">How It Works:</span> Policies define access based on user attributes, resource attributes, and environmental context.</p>
</li>
</ul>
<h4 id="full-service-authentication-and-authorization-providers">Full-Service Authentication and Authorization Providers </h4>
<p>For projects where you don’t want to build these systems from scratch, use managed services:</p>
<p>1.<strong>Auth0:</strong></p>
<ul>
<li>Provides full authentication, authorization, and user management.</li>
<li>Supports passwordless login, social logins, and multi-factor authentication.</li>
<li>Easy to integrate with Express via <a href="https://auth0.com/docs/libraries">Auth0 SDK</a>.</li>
</ul>
<p>2 <strong>Firebase Authentication:</strong></p>
<ul>
<li>Part of <a href="https://firebase.google.com/">Google Firebase</a>.</li>
<li>Handles email/password, social login, and phone authentication.</li>
<li>Best for projects already using Firebase.</li>
</ul>
<p>3.<strong>AWS Cognito:</strong></p>
<ul>
<li>Amazon’s identity and access management service. <a href="https://aws.amazon.com/de/cognito/">AWS Cognito</a></li>
<li>Ideal for applications deployed on AWS.</li>
</ul>
<p>4.<strong>Okta:</strong></p>
<ul>
<li>Enterprise-grade identity service.</li>
<li>Great for complex user management needs.</li>
</ul>
<h4 id="middleware-for-protection">Middleware for Protection </h4>
<p>In simple terms, Middleware ensures that only authorized users can access protected routes.</p>
 <p style="font-size: 14px; font-weight: bold">Example Middleware for Authentication:</p>
<pre data-role="codeBlock" data-info="ts" class="language-ts ts"><code><span class="token operator">*</span> TypeScript<span class="token operator">:</span>

<span class="token keyword keyword-import">import</span> jwt <span class="token keyword keyword-from">from</span> <span class="token string">'jsonwebtoken'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response<span class="token punctuation">,</span> NextFunction <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">authenticate</span> <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">,</span> next<span class="token operator">:</span> NextFunction<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token operator">?.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Unauthorized'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> decoded <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">JWT_SECRET</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span>user <span class="token operator">=</span> decoded<span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Forbidden'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-export">export</span> <span class="token keyword keyword-default">default</span> authenticate<span class="token punctuation">;</span>
</code></pre><p>5.<strong>Best Practices</strong></p>
<ul>
<li><span style="font-size: 14px; font-weight: bold">Use HTTPS:</span>
<ul>
<li>Always secure your API with HTTPS to protect sensitive data.</li>
</ul>
</li>
<li><span style="font-size: 14px; font-weight: bold">Secure JWTs:</span>
<ul>
<li>Use strong secrets for signing tokens.</li>
<li>Set expiration times for tokens and handle refresh tokens securely.</li>
</ul>
</li>
<li><span style="font-size: 14px; font-weight: bold">Rate Limiting:</span>
<ul>
<li>Use libraries like express-rate-limit to prevent abuse.</li>
</ul>
</li>
<li><span style="font-size: 14px; font-weight: bold">Validate Input:</span>
<ul>
<li>Use libraries like Joi or Zod to validate incoming requests.</li>
</ul>
</li>
<li><span style="font-size: 14px; font-weight: bold">Audit Logs:</span>
<ul>
<li>Maintain logs for authentication and authorization events for monitoring and debugging.</li>
</ul>
</li>
</ul>
<h4 id="example-workflow">Example Workflow </h4>
<p>1.<strong>Authentication:</strong></p>
<ul>
<li>User logs in with email/password.</li>
<li>A JWT is issued and sent to the client</li>
</ul>
<p>2.<strong>Authorization:</strong></p>
<ul>
<li>Each route checks the user's role/permissions using middleware.</li>
<li>Actions like creating products are restricted to admin users.</li>
</ul>
<p>3.<strong>Protected Routes:</strong></p>
<ul>
<li>Routes validate the JWT and allow access only if the token is valid.</li>
</ul>
<h3 id="p-stylebackground-purple-color-yellow-padding-15pxcomparison-of-session-based-authentication-and-stateless-authentication-eg-jwt-along-with-recommendations-for-security-conscious-use-casesp"><p style="background: purple; color: yellow; padding: 15px">Comparison of session-based authentication and stateless authentication (e.g., JWT), along with recommendations for security-conscious use cases.</p> </h3>
<h4 id="session-based-authentication">Session-Based Authentication </h4>
<p>Session-based authentication involves storing session data on the server and using cookies to maintain user sessions.</p>
<p><span style="font-size: 14px; font-weight: bold">How It Works:</span></p>
<ol>
<li>
<p>User logs in, and the server creates a session (a unique ID linked to the user) and stores it in a database or in-memory store (e.g., Redis).</p>
</li>
<li>
<p>The session ID is sent to the client as a cookie.</p>
</li>
<li>
<p>On subsequent requests, the client includes the cookie, and the server retrieves the session data to authenticate the user.</p>
</li>
</ol>
<p><strong>Pros:</strong></p>
<ul>
<li>
<p><span style="font-size: 14px; font-weight: bold">Server-Side Control:</span></p>
<ul>
<li>Session data is stored on the server, so the server can invalidate a session at any time (e.g., during logout or for suspicious activity).</li>
</ul>
</li>
<li>
<p><span style="font-size: 14px; font-weight: bold">Easier to Implement in Monolithic Applications:</span></p>
<ul>
<li>Especially when the frontend and backend are tightly coupled.</li>
</ul>
</li>
<li>
<p><span style="font-size: 14px; font-weight: bold">More Secure Against Token Theft</span></p>
<ul>
<li>Since cookies can be configured with <code>HttpOnly</code>, <code>Secure</code>, and <code>SameSite</code> attributes, they are less likely to be stolen via client-side attacks like XSS.</li>
</ul>
</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>
<p><span style="font-size: 14px; font-weight: bold">Scalability Issues</span></p>
<ul>
<li>The server must store session data, which increases memory usage as the number of users grows. Scaling requires a centralized session store (e.g., Redis), which adds complexity.</li>
</ul>
</li>
<li>
<p><span style="font-size: 14px; font-weight: bold">Tied to Cookies</span></p>
<ul>
<li>Requires careful configuration of cookies (<code>HttpOnly</code>, <code>Secure</code>, <code>SameSite</code>, etc.) to prevent attacks like CSRF and XSS.</li>
</ul>
</li>
<li>
<p><span style="font-size: 14px; font-weight: bold">Stateful</span></p>
<ul>
<li>Sessions need to be stored and managed, making it less suitable for highly distributed or serverless architectures.</li>
</ul>
</li>
</ul>
<h4 id="stateless-authentication-jwt">Stateless Authentication (JWT) </h4>
<p>Stateless authentication uses self-contained tokens, typically in the form of JSON Web Tokens (JWTs), to authenticate users.</p>
<p style="font-size: 14px; font-weight: bold">How It Works:</p>
<ol>
<li>
<p>User logs in, and the server generates a signed JWT containing claims (e.g., user ID, roles).</p>
</li>
<li>
<p>The token is sent to the client (usually stored in <code>Authorization</code> headers or localStorage).</p>
</li>
<li>
<p>On subsequent requests, the server validates the token's signature without storing any state.</p>
</li>
</ol>
<p><strong>Pros:</strong></p>
<ul>
<li>
<p style="font-size: 14px; font-weight: bold">Scalability:</p>
<ul>
<li>No need to store session data on the server. Each request is stateless, making it ideal for distributed or serverless environments.</li>
</ul>
</li>
<li>
<p style="font-size: 14px; font-weight: bold">Flexibility:</p>
<ul>
<li>Tokens can be used across multiple services or APIs without needing centralized session storage.</li>
</ul>
</li>
<li>
<p style="font-size: 14px; font-weight: bold">Performance:</p>
<ul>
<li>Eliminates database lookups for session data.</li>
</ul>
</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>
<p style="font-size: 14px; font-weight: bold">Token Revocation</p>
<ul>
<li>Once issued, tokens cannot be easily revoked unless you implement a token blacklist, which reintroduces some state.</li>
</ul>
</li>
<li>
<p style="font-size: 14px; font-weight: bold">Security Concerns with Token Storage</p>
<ul>
<li>Storing tokens in <code>localStorage</code> exposes them to XSS attacks, while storing them in cookies makes them vulnerable to CSRF attacks (though mitigated with <code>SameSite</code> cookies).</li>
</ul>
</li>
<li>
<p style="font-size: 14px; font-weight: bold">Payload Size</p>
<ul>
<li>Tokens can grow large if they include too many claims, which increases request sizes.</li>
</ul>
</li>
</ul>
<h4 id="security-considerations">Security Considerations </h4>
<p><strong>Session-Based Authentication:</strong></p>
<ul>
<li>
<p style="font-size: 14px; font-weight: bold">Pros for Security:</p>
<ul>
<li>
<p>Centralized session management allows easy invalidation of compromised sessions.</p>
</li>
<li>
<p><code>HttpOnly</code> and <code>Secure</code> cookies mitigate risks from XSS.</p>
</li>
<li>
<p>Strong against CSRF when combined with proper cookie attributes and CSRF tokens.</p>
</li>
</ul>
</li>
<li>
<p style="font-size: 14px; font-weight: bold">Cons for Security</p>
<ul>
<li>Server needs to trust and properly protect the session store.</li>
<li>More configuration is required to secure cookies properly.</li>
</ul>
</li>
</ul>
<p><strong>Stateless Authentication (JWT):</strong></p>
<ul>
<li>
<p style="font-size: 14px; font-weight: bold">Pros for Security:</p>
<ul>
<li>Tokens are signed, so they cannot be tampered with.</li>
<li>Can include expiration times to limit the window for token abuse.</li>
</ul>
</li>
<li>
<p style="font-size: 14px; font-weight: bold">Cons for Security:</p>
<ul>
<li>Difficult to revoke tokens without additional mechanisms like a blacklist.</li>
<li>Tokens stored in the client are vulnerable to theft, requiring secure storage and transport mechanisms.</li>
</ul>
</li>
</ul>
<h4 id="best-choice-for-security">Best Choice for Security </h4>
<p>The best choice depends on your architecture and specific requirements. Here’s a recommendation based on security concerns:</p>
<p><strong>Use Session-Based Authentication When:</strong></p>
<ul>
<li>You are building a monolithic application with centralized session storage.</li>
<li>You prioritize security over scalability (e.g., banking apps, internal enterprise systems).</li>
<li>You want fine-grained control over session invalidation.</li>
</ul>
<p><strong>Use Stateless Authentication (JWT) When:</strong></p>
<ul>
<li>You are building a distributed or serverless application.</li>
<li>Scalability and performance are critical.</li>
<li>You are comfortable implementing additional security measures (e.g., token rotation, blacklisting, shorter token lifetimes).</li>
</ul>
<h4 id="hybrid-approach-best-practice-for-security-and-scalability">Hybrid Approach (Best Practice for Security and Scalability) </h4>
<p>You can combine the strengths of both approaches:</p>
<ul>
<li>Use stateless JWTs for initial authentication but issue short-lived tokens.</li>
<li>Use a refresh token stored in a secure, HttpOnly cookie for reissuing tokens when they expire.</li>
<li>Implement a token blacklist or a token revocation list to handle compromised tokens.</li>
</ul>
<p style="font-size: 14px; font-weight: bold">Example:</p>
<ol>
<li>
<p>JWT for access: Short-lived token (e.g., 15 minutes) stored in memory or headers.</p>
</li>
<li>
<p>Refresh token: Long-lived, securely stored (e.g., in an HttpOnly cookie).</p>
</li>
<li>
<p>Backend logic</p>
<ul>
<li>Validate access tokens for normal requests.</li>
<li>Use refresh tokens only when access tokens expire.</li>
<li>Maintain a blacklist of revoked refresh tokens.</li>
</ul>
</li>
</ol>
<h3 id="summary-table">Summary Table </h3>
<table>
<tbody><tr>
  <th>Feature</th>
  <th>Session-Based Authentication</th>
  <th>Stateless Authentication (JWT)</th>
</tr>
<tr>
  <td style="font-size: 14px; font-weight: bold">Scalability</td>
  <td style="font-size: 14px;">Limited, requires session store</td>
  <td style="font-size: 14px;">Highly scalable</td>
</tr>
<tr>
  <td style="font-size: 14px; font-weight: bold">Ease of Implementation</td>
    <td style="font-size: 14px;">Simpler for monoliths</td>
  <td style="font-size: 14px;">Simpler for distributed systems</td>
</tr>
<tr>
  <td style="font-size: 14px; font-weight: bold">Security</td>
    <td style="font-size: 14px;">Stronger control, revocable</td>
  <td style="font-size: 14px;">Harder to revoke</td>
</tr>
<tr>
<td style="font-size: 14px; font-weight: bold">Storage</td>
  <td style="font-size: 14px;">Server-side</td>
  <td style="font-size: 14px;">Client-side</td>
</tr>
<tr>
<td style="font-size: 14px; font-weight: bold">Use Case</td>
 <td style="font-size: 14px;">Banking, enterprise systems</td>
  <td style="font-size: 14px;">Distributed systems, APIs, microservices</td>
</tr>
</tbody></table>
<h3 id="conclusion">Conclusion </h3>
<p>For security-sensitive use cases, session-based authentication with well-configured cookies is generally safer. For distributed systems, consider a hybrid approach to balance security and scalability.<br>
<br><br>
<br></p>
<h3 id="recomendation-and-example">Recomendation and Example </h3>
<p>When combining <a href="https://www.passportjs.org/">Passport.js</a> with JWT (stateless authentication), the industry-standard strategy is the <code>passport-jwt</code> strategy. This approach leverages JSON Web Tokens for authentication while benefiting from Passport's modularity and middleware-based integration.</p>
<p><strong>Why</strong> <code>passport-jwt?</code></p>
<p>1.<strong>Stateless Authentication:</strong></p>
<ul>
<li>No need for server-side session management. The server only validates the JWT, which contains all the necessary user information.</li>
</ul>
<p>2.<strong>Compatibility:</strong></p>
<ul>
<li>passport-jwt works seamlessly with token-based workflows, such as API authentication or Single Page Applications (SPAs).</li>
</ul>
<p>3.<strong>Security:</strong></p>
<ul>
<li>JWTs are signed using a secret (HS256) or private/public key pair (RS256), ensuring tamper-proof authentication tokens.</li>
</ul>
<p>4.<strong>Flexibility:</strong></p>
<ul>
<li>Works well with other Passport strategies, allowing a hybrid approach (e.g., OAuth2 for initial login, JWT for subsequent requests)</li>
</ul>
<h4 id="typical-setup-for-passport-jwt">Typical Setup for <code>passport-jwt</code> </h4>
<p>1.<strong>Install Required Packages</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">bash</span>
<span class="token function">npm</span> <span class="token function">install</span> passport passport-jwt jsonwebtoken
</code></pre><p>2.<strong>Configure the JWT Strategy</strong></p>
<pre data-role="codeBlock" data-info="ts" class="language-ts ts"><code><span class="token keyword keyword-import">import</span> passport <span class="token keyword keyword-from">from</span> <span class="token string">'passport'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> Strategy <span class="token keyword keyword-as">as</span> JwtStrategy<span class="token punctuation">,</span> ExtractJwt <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'passport-jwt'</span><span class="token punctuation">;</span>

<span class="token comment">// Your secret or private key</span>
<span class="token keyword keyword-const">const</span> <span class="token constant">JWT_SECRET</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">JWT_SECRET</span> <span class="token operator">||</span> <span class="token string">'your_secret_key'</span><span class="token punctuation">;</span>

<span class="token comment">// JWT options</span>
<span class="token keyword keyword-const">const</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span>
  jwtFromRequest<span class="token operator">:</span> ExtractJwt<span class="token punctuation">.</span><span class="token function">fromAuthHeaderAsBearerToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  secretOrKey<span class="token operator">:</span> <span class="token constant">JWT_SECRET</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Define the strategy</span>
passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token keyword keyword-new">new</span> <span class="token class-name">JwtStrategy</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span>jwtPayload<span class="token punctuation">,</span> done<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// Example: Validate the user based on the payload</span>
      <span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">findUserById</span><span class="token punctuation">(</span>jwtPayload<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Replace with your DB call</span>
      <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Pass user to req.user</span>
      <span class="token punctuation">}</span>
      <span class="token keyword keyword-return">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// No user found</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-return">return</span> <span class="token function">done</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>3.<strong>Issue a JWT on Login</strong><br>
Use a library like <code>jsonwebtoken</code> to generate a token when the user logs in.</p>
<pre data-role="codeBlock" data-info="ts" class="language-ts ts"><code><span class="token keyword keyword-import">import</span> jwt <span class="token keyword keyword-from">from</span> <span class="token string">'jsonwebtoken'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token constant">JWT_SECRET</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">JWT_SECRET</span> <span class="token operator">||</span> <span class="token string">'your_secret_key'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">generateToken</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> username<span class="token operator">:</span> user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> role<span class="token operator">:</span> user<span class="token punctuation">.</span>role <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// Payload</span>
    <span class="token constant">JWT_SECRET</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> expiresIn<span class="token operator">:</span> <span class="token string">'1h'</span> <span class="token punctuation">}</span> <span class="token comment">// Expiration time</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>4.<strong>Protect Routes Using Middleware</strong></p>
<pre data-role="codeBlock" data-info="ts" class="language-ts ts"><code><span class="token keyword keyword-import">import</span> express <span class="token keyword keyword-from">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Protect an endpoint</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
  <span class="token string">'/protected'</span><span class="token punctuation">,</span>
  passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'jwt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> session<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'You are authorized!'</span><span class="token punctuation">,</span> user<span class="token operator">:</span> req<span class="token punctuation">.</span>user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="best-practices-when-using-passport-jwt">Best Practices When Using <code>passport-jwt</code> </h4>
<p>1.<span style="font-size: 14px; font-weight: bold">Use Short-Lived Tokens:</span></p>
<ul>
<li>Set the JWT expiration (exp) to a short time (e.g., 15 minutes) and implement a refresh token mechanism for re-issuing tokens securely.</li>
</ul>
<p>2.<span style="font-size: 14px; font-weight: bold">Secure Token Storage:</span></p>
<ul>
<li>Store tokens securely on the client:</li>
<li>Use <code>HttpOnly</code> cookies for web applications (mitigates XSS attacks).</li>
<li>Avoid storing tokens in <code>localStorage</code> or <code>sessionStorage</code> unless necessary.</li>
</ul>
<p>3.<span style="font-size: 14px; font-weight: bold">Validate Tokens on Each Request:</span></p>
<ul>
<li>Ensure token signatures and expiration times are validated for every incoming request.</li>
</ul>
<p>4.<span style="font-size: 14px; font-weight: bold">Token Revocation:</span></p>
<ul>
<li>Implement a token blacklist or revocation mechanism (e.g., storing revoked tokens or sessions in a database) for high-security requirements.</li>
</ul>
<p>5.<span style="font-size: 14px; font-weight: bold">Combine with Other Strategies:</span></p>
<ul>
<li>Use passport-local for login and token issuance:</li>
<li>Authenticate username/password using passport-local.</li>
<li>Issue a JWT on successful login.</li>
</ul>
<p><strong>Example Hybrid Flow: Combining <code>passport-local</code> with <code>passport-jwt</code></strong></p>
<p>1.<strong>Install <code>passport-local</code></strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">bash</span>
<span class="token function">npm</span> <span class="token function">install</span> passport-local
</code></pre><p>2.<strong>Configure <code>passport-local</code></strong></p>
<pre data-role="codeBlock" data-info="ts" class="language-ts ts"><code>TypeScript<span class="token operator">:</span>

<span class="token keyword keyword-import">import</span> <span class="token punctuation">{</span> Strategy <span class="token keyword keyword-as">as</span> LocalStrategy <span class="token punctuation">}</span> <span class="token keyword keyword-from">from</span> <span class="token string">'passport-local'</span><span class="token punctuation">;</span>

<span class="token comment">// Example local strategy</span>
passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token keyword keyword-new">new</span> <span class="token class-name">LocalStrategy</span><span class="token punctuation">(</span><span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> done<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> <span class="token keyword keyword-await">await</span> <span class="token function">findUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Replace with your DB call</span>
      <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">validatePassword</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Invalid credentials'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword keyword-return">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-return">return</span> <span class="token function">done</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>3.<strong>Login Route (Issue JWT)</strong></p>
<pre data-role="codeBlock" data-info="ts" class="language-ts ts"><code>TypeScript<span class="token operator">:</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">'local'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> session<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">,</span> info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>err <span class="token operator">||</span> <span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-return">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> info<span class="token operator">?.</span>message <span class="token operator">||</span> <span class="token string">'Unauthorized'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Generate token</span>
    <span class="token keyword keyword-const">const</span> token <span class="token operator">=</span> <span class="token function">generateToken</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> token <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><br>
<h4 id="summary">Summary </h4>
v
  <table>
<tbody><tr>
  <th>Feature</th>
  <th>Session-Based (passport-local)</th>
  <th>JWT-Based (passport-jwt))</th>
</tr>
<tr>
  <td style="font-size: 14px; font-weight: bold">Statefulness</td>
  <td style="font-size: 14px;">Requires session store</td>
  <td style="font-size: 14px;">Stateless</td>
</tr>
<tr>
  <td style="font-size: 14px; font-weight: bold">Scalability</td>
    <td style="font-size: 14px;">Limited</td>
  <td style="font-size: 14px;">Highly scalable</td>
</tr>
<tr>
  <td style="font-size: 14px; font-weight: bold">Security</td>
    <td style="font-size: 14px;">Centralized control</td>
  <td style="font-size: 14px;">Decentralized, token revocation needed</td>
</tr>
<tr>
<td style="font-size: 14px; font-weight: bold">Best Use Case</td>
  <td style="font-size: 14px;">Monolithic apps</td><td style="font-size: 14px;">Distributed apps, APIs</td>
</tr>
</tbody></table>
<br>
<p>Was this page helpful?</p>
<p style="background: purple; color: yellow; padding: 15px">If you find this article helpful, please feel free to share the link.</p>
<p>Yes👍 No👎</p>
<button style="color: #fff; background: #000; padding: 10px 20px; font-size: 20px; margin-bottom: 50px; cursor: pointer; border-radius: 5px; float: right;">
  <i class="el el-arrow-up">
    &#x2191;
</i>
</button>

<script>
  document.querySelector('button').addEventListener('click', () => {
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });
</script>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>